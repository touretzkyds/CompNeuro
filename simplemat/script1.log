>> script1
echo on

% first key-value pair
kA = [1 1 0 0 0 0]'

kA =

     1
     1
     0
     0
     0
     0

vA = [5 4 3 2 1]'

vA =

     5
     4
     3
     2
     1

pause

% second key-value pair
kB = [0 0 1 1 0 0]'

kB =

     0
     0
     1
     1
     0
     0

vB = [3 1 4 1 5]'

vB =

     3
     1
     4
     1
     5

pause

% third key-value pair
kC = [0 0 0 0 1 1]'

kC =

     0
     0
     0
     0
     1
     1

vC = [2 4 6 8 10]'

vC =

     2
     4
     6
     8
    10

pause

% make the memory
M = vA*kA'/sum(kA) + vB*kB'/sum(kB) + vC*kC'/sum(kC)

M =

    2.5000    2.5000    1.5000    1.5000    1.0000    1.0000
    2.0000    2.0000    0.5000    0.5000    2.0000    2.0000
    1.5000    1.5000    2.0000    2.0000    3.0000    3.0000
    1.0000    1.0000    0.5000    0.5000    4.0000    4.0000
    0.5000    0.5000    2.5000    2.5000    5.0000    5.0000

pause

% test the memory
M * kA

ans =

     5
     4
     3
     2
     1

M * kB

ans =

     3
     1
     4
     1
     5

M * kC

ans =

     2
     4
     6
     8
    10

pause

% add a fourth key-value pair: not orthogonal
kD = [1 0 0 0 0 1]'

kD =

     1
     0
     0
     0
     0
     1

vD = [9 8 7 6 5]'

vD =

     9
     8
     7
     6
     5

pause

% make the memory again
Mx = vA*kA'/sum(kA) + vB*kB'/sum(kB) + vC*kC'/sum(kC) + vD*kD'/sum(kD)

Mx =

    7.0000    2.5000    1.5000    1.5000    1.0000    5.5000
    6.0000    2.0000    0.5000    0.5000    2.0000    6.0000
    5.0000    1.5000    2.0000    2.0000    3.0000    6.5000
    4.0000    1.0000    0.5000    0.5000    4.0000    7.0000
    3.0000    0.5000    2.5000    2.5000    5.0000    7.5000

pause

% test with four key-value pairs:  results are bad
Mx * kA

ans =

    9.5000
    8.0000
    6.5000
    5.0000
    3.5000

Mx * kB

ans =

     3
     1
     4
     1
     5

Mx * kC

ans =

    6.5000
    8.0000
    9.5000
   11.0000
   12.5000

Mx * kD

ans =

   12.5000
   12.0000
   11.5000
   11.0000
   10.5000

pause

% keys are linearly independent: use pseudo-inverse to make the weight matrix
K = [kA kB kC kD]

K =

     1     0     0     1
     1     0     0     0
     0     1     0     0
     0     1     0     0
     0     0     1     0
     0     0     1     1

V = [vA vB vC vD]

V =

     5     3     2     9
     4     1     4     8
     3     4     6     7
     2     1     8     6
     1     5    10     5


MM = V*pinv(K)

MM =

    5.2500   -0.2500    1.5000    1.5000   -1.7500    3.7500
    4.0000   -0.0000    0.5000    0.5000   -0.0000    4.0000
    2.7500    0.2500    2.0000    2.0000    1.7500    4.2500
    1.5000    0.5000    0.5000    0.5000    3.5000    4.5000
    0.2500    0.7500    2.5000    2.5000    5.2500    4.7500

pause

% test the pseudo-inverse weight matrix: results are correct
MM * kA

ans =

     5
     4
     3
     2
     1

MM * kB

ans =

    3.0000
    1.0000
    4.0000
    1.0000
    5.0000

MM * kC

ans =

    2.0000
    4.0000
    6.0000
    8.0000
   10.0000

MM * kD

ans =

    9.0000
    8.0000
    7.0000
    6.0000
    5.0000

